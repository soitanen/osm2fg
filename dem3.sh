#!/bin/bash

#parsing boundaries
while getopts "n:s:w:e:t:" OPTION
do
     case $OPTION in
         n)
             n=$OPTARG
             ;;
         s)
             s=$OPTARG
             ;;
         w)
             w=$OPTARG
             ;;
         e)
             e=$OPTARG
             ;;
         t)
             tg=$OPTARG
             ;;
     esac
done

rm -rf $PWD/work/SRTM-3
rm -rf $PWD/work/SRTM-1

case $w in
-180|-179|-178|-177|-176|-175)gkw=1;;
-174|-173|-172|-171|-170|-169)gkw=2;;
-168|-167|-166|-165|-164|-163)gkw=3;;
-162|-161|-160|-159|-158|-157)gkw=4;;
-156|-155|-154|-153|-152|-151)gkw=5;;
-150|-149|-148|-147|-146|-145)gkw=6;;
-144|-143|-142|-141|-140|-139)gkw=7;;
-138|-137|-136|-135|-134|-133)gkw=8;;
-132|-131|-130|-129|-128|-127)gkw=9;;
-126|-125|-124|-123|-122|-121)gkw=10;;
-120|-119|-118|-117|-116|-115)gkw=11;;
-114|-113|-112|-111|-110|-109)gkw=12;;
-108|-107|-106|-105|-104|-103)gkw=13;;
-102|-101|-100|-99|-98|-97)gkw=14;;
-96|-95|-94|-93|-92|-91)gkw=15;;
-90|-89|-88|-87|-86|-85)gkw=16;;
-84|-83|-82|-81|-80|-79)gkw=17;;
-78|-77|-76|-75|-74|-73)gkw=18;;
-72|-71|-70|-69|-68|-67)gkw=19;;
-66|-65|-64|-63|-62|-61)gkw=20;;
-60|-59|-58|-57|-56|-55)gkw=21;;
-54|-53|-52|-51|-50|-49)gkw=22;;
-48|-47|-46|-45|-44|-43)gkw=23;;
-42|-41|-40|-39|-38|-37)gkw=24;;
-36|-35|-34|-33|-32|-31)gkw=25;;
-30|-29|-28|-27|-26|-25)gkw=26;;
-24|-23|-22|-21|-20|-19)gkw=27;;
-18|-17|-16|-15|-14|-13)gkw=28;;
-12|-11|-10|-9|-8|-7)gkw=29;;
-6|-5|-4|-3|-2|-1)gkw=30;;
0|1|2|3|4|5)gkw=31;;
6|7|8|9|10|11)gkw=32;;
12|13|14|15|16|17)gkw=33;;
18|19|20|21|22|23)gkw=34;;
24|25|26|27|28|29)gkw=35;;
30|31|32|33|34|35)gkw=36;;
36|37|38|39|40|41)gkw=37;;
42|43|44|45|46|47)gkw=38;;
48|49|50|51|52|53)gkw=39;;
54|55|56|57|58|59)gkw=40;;
60|61|62|63|64|65)gkw=41;;
66|67|68|69|70|71)gkw=42;;
72|73|74|75|76|77)gkw=43;;
78|79|80|81|82|83)gkw=44;;
84|85|86|87|88|89)gkw=45;;
90|91|92|93|94|95)gkw=46;;
96|97|98|99|100|101)gkw=47;;
102|103|104|105|106|107)gkw=48;;
108|109|110|111|112|113)gkw=49;;
114|115|116|117|118|119)gkw=50;;
120|121|122|123|124|125)gkw=51;;
126|127|128|129|130|131)gkw=52;;
132|133|134|135|136|137)gkw=53;;
138|139|140|141|142|143)gkw=54;;
144|145|146|147|148|149)gkw=55;;
150|151|152|153|154|155)gkw=56;;
156|157|158|159|160|161)gkw=57;;
162|163|164|165|166|167)gkw=58;;
168|169|170|171|172|173)gkw=59;;
174|175|176|177|178|179)gkw=60;;
esac

case $e in
-179|-178|-177|-176|-175|-174)gke=1;;
-173|-172|-171|-170|-169|-168)gke=2;;
-167|-166|-165|-164|-163|-162)gke=3;;
-161|-160|-159|-158|-157|-156)gke=4;;
-155|-154|-153|-152|-151|-150)gke=5;;
-149|-148|-147|-146|-145|-144)gke=6;;
-143|-142|-141|-140|-139|-138)gke=7;;
-137|-136|-135|-134|-133|-132)gke=8;;
-131|-130|-129|-128|-127|-126)gke=9;;
-125|-124|-123|-122|-121|-120)gke=10;;
-119|-118|-117|-116|-115|-114)gke=11;;
-113|-112|-111|-110|-109|-108)gke=12;;
-107|-106|-105|-104|-103|-102)gke=13;;
-101|-100|-99|-98|-97|-96)gke=14;;
-95|-94|-93|-92|-91|-90)gke=15;;
-89|-88|-87|-86|-85|-84)gke=16;;
-83|-82|-81|-80|-79|-78)gke=17;;
-77|-76|-75|-74|-73|-72)gke=18;;
-71|-70|-69|-68|-67|-66)gke=19;;
-65|-64|-63|-62|-61|-60)gke=20;;
-59|-58|-57|-56|-55|-54)gke=21;;
-53|-52|-51|-50|-49|-48)gke=22;;
-47|-46|-45|-44|-43|-42)gke=23;;
-41|-40|-39|-38|-37|-36)gke=24;;
-35|-34|-33|-32|-31|-30)gke=25;;
-29|-28|-27|-26|-25|-24)gke=26;;
-23|-22|-21|-20|-19|-18)gke=27;;
-17|-16|-15|-14|-13|-12)gke=28;;
-11|-10|-9|-8|-7|-6)gke=29;;
-5|-4|-3|-2|-1|0)gke=30;;
1|2|3|4|5|6)gke=31;;
7|8|9|10|11|12)gke=32;;
13|14|15|16|17|18)gke=33;;
19|20|21|22|23|24)gke=34;;
25|26|27|28|29|30)gke=35;;
31|32|33|34|35|36)gke=36;;
37|38|39|40|41|42)gke=37;;
43|44|45|46|47|48)gke=38;;
49|50|51|52|53|54)gke=39;;
55|56|57|58|59|60)gke=40;;
61|62|63|64|65|66)gke=41;;
67|68|69|70|71|72)gke=42;;
73|74|75|76|77|78)gke=43;;
79|80|81|82|83|84)gke=44;;
85|86|87|88|89|90)gke=45;;
91|92|93|94|95|96)gke=46;;
97|98|99|100|101|102)gke=47;;
103|104|105|106|107|108)gke=48;;
109|110|111|112|113|114)gke=49;;
115|116|117|118|119|120)gke=50;;
121|122|123|124|125|126)gke=51;;
127|128|129|130|131|132)gke=52;;
133|134|135|136|137|138)gke=53;;
139|140|141|142|143|144)gke=54;;
145|146|147|148|149|150)gke=55;;
151|152|153|154|155|156)gke=56;;
157|158|159|160|161|162)gke=57;;
163|164|165|166|167|168)gke=58;;
169|170|171|172|173|174)gke=59;;
175|176|177|178|179|180)gke=60;;
esac

case $n in
-89|-88)gkn=0;;
-87|-86|-85|-84)gkn=1;;
-83|-82|-81|-80)gkn=2;;
-79|-78|-77|-76)gkn=3;;
-75|-74|-73|-72)gkn=4;;
-71|-70|-69|-68)gkn=5;;
-67|-66|-65|-64)gkn=6;;
-63|-62|-61|-60)gkn=7;;
-59|-58|-57|-56)gkn=8;;
-55|-54|-53|-52)gkn=9;;
-51|-50|-49|-48)gkn=10;;
-47|-46|-45|-44)gkn=11;;
-43|-42|-41|-40)gkn=12;;
-39|-38|-37|-36)gkn=13;;
-35|-34|-33|-32)gkn=14;;
-31|-30|-29|-28)gkn=15;;
-27|-26|-25|-24)gkn=16;;
-23|-22|-21|-20)gkn=17;;
-19|-18|-17|-16)gkn=18;;
-15|-14|-13|-12)gkn=19;;
-11|-10|-9|-8)gkn=20;;
-7|-6|-5|-4)gkn=21;;
-3|-2|-1|0)gkn=22;;
1|2|3|4)gkn=23;;
5|6|7|8)gkn=24;;
9|10|11|12)gkn=25;;
13|14|15|16)gkn=26;;
17|18|19|20)gkn=27;;
21|22|23|24)gkn=28;;
25|26|27|28)gkn=29;;
29|30|31|32)gkn=30;;
33|34|35|36)gkn=31;;
37|38|39|40)gkn=32;;
41|42|43|44)gkn=33;;
45|46|47|48)gkn=34;;
49|50|51|52)gkn=35;;
53|54|55|56)gkn=36;;
57|58|59|60)gkn=37;;
61|62|63|64)gkn=38;;
65|66|67|68)gkn=39;;
69|70|71|72)gkn=40;;
73|74|75|76)gkn=41;;
77|78|79|80)gkn=42;;
81|82|83|84)gkn=43;;
85|86|87|88)gkn=44;;
89|90)gkn=45;;
esac

case $s in
-90|-89)gks=0;;
-88|-87|-86|-85)gks=1;;
-84|-83|-82|-81)gks=2;;
-80|-79|-78|-77)gks=3;;
-76|-75|-74|-73)gks=4;;
-72|-71|-70|-69)gks=5;;
-68|-67|-66|-65)gks=6;;
-64|-63|-62|-61)gks=7;;
-60|-59|-58|-57)gks=8;;
-56|-55|-54|-53)gks=9;;
-52|-51|-50|-49)gks=10;;
-48|-47|-46|-45)gks=11;;
-44|-43|-42|-41)gks=12;;
-40|-39|-38|-37)gks=13;;
-36|-35|-34|-33)gks=14;;
-32|-31|-30|-29)gks=15;;
-28|-27|-26|-25)gks=16;;
-24|-23|-22|-21)gks=17;;
-20|-19|-18|-17)gks=18;;
-16|-15|-14|-13)gks=19;;
-12|-11|-10|-9)gks=20;;
-8|-7|-6|-5)gks=21;;
-4|-3|-2|-1)gks=22;;
0|1|2|3)gks=23;;
4|5|6|7)gks=24;;
8|9|10|11)gks=25;;
12|13|14|15)gks=26;;
16|17|18|19)gks=27;;
20|21|22|23)gks=28;;
24|25|26|27)gks=29;;
28|29|30|31)gks=30;;
32|33|34|35)gks=31;;
36|37|38|39)gks=32;;
40|41|42|43)gks=33;;
44|45|46|47)gks=34;;
48|49|50|51)gks=35;;
52|53|54|55)gks=36;;
56|57|58|59)gks=37;;
60|61|62|63)gks=38;;
64|65|66|67)gks=39;;
68|69|70|71)gks=40;;
72|73|74|75)gks=41;;
76|77|78|79)gks=42;;
80|81|82|83)gks=43;;
84|85|86|87)gks=44;;
88|89)gks=45;;
esac

echo "   $gkn"
echo "$gkw    $gke"
echo "   $gks"

for lat in `seq $gks $gkn`;
    do
	case $lat in
	0)corlat=SW;;
	1)corlat=SV;;
	2)corlat=SU;;
	3)corlat=ST;;
	4)corlat=SS;;
	5)corlat=SR;;
	6)corlat=SQ;;
	7)corlat=SP;;
	8)corlat=SO;;
	9)corlat=SN;;
	10)corlat=SM;;
	11)corlat=SL;;
	12)corlat=SK;;
	13)corlat=SJ;;
	14)corlat=SI;;
	15)corlat=SH;;
	16)corlat=SG;;
	17)corlat=SF;;
	18)corlat=SE;;
	19)corlat=SD;;
	20)corlat=SC;;
	21)corlat=SB;;
	22)corlat=SA;;
	23)corlat=A;;
	24)corlat=B;;
	25)corlat=C;;
	26)corlat=D;;
	27)corlat=E;;
	28)corlat=F;;
	29)corlat=G;;
	30)corlat=H;;
	31)corlat=I;;
	32)corlat=J;;
	33)corlat=K;;
	34)corlat=L;;
	35)corlat=M;;
	36)corlat=N;;
	37)corlat=O;;
	38)corlat=P;;
	39)corlat=Q;;
	40)corlat=R;;
	41)corlat=S;;
	42)corlat=T;;
	43)corlat=U;;
	44)corlat=V;;
	45)corlat=W;;
	esac
        for lon in `seq $gkw $gke`;
            do
		if [ $lon -gt 9 ]		
		then
			hgtfile="$corlat""$lon.zip"
		else
			hgtfile="$corlat""0$lon.zip"
		fi
		case $hgtfile in
			R33.zip)hgtfile="R33v2.zip";;
			R34.zip)hgtfile="R34v2.zip";;
			R35.zip)hgtfile="R35v2.zip";;
			R36.zip)hgtfile="R36v2.zip";;
			R37.zip)hgtfile="R37v2.zip";;
			R38.zip)hgtfile="R38v2.zip";;
			Q32.zip)hgtfile="Q32v2.zip";;
			Q33.zip)hgtfile="Q33v2.zip";;
			Q34.zip)hgtfile="Q34v2.zip";;
			Q35.zip)hgtfile="Q35v2.zip";;
			Q36.zip)hgtfile="Q36v2.zip";;
			Q37.zip)hgtfile="Q37v2.zip";;
			Q38.zip)hgtfile="Q38v2.zip";;
			Q39.zip)hgtfile="Q39v2.zip";;
			Q40.zip)hgtfile="Q40v2.zip";;
			P31.zip)hgtfile="P31v2.zip";;
			P32.zip)hgtfile="P32v2.zip";;
			P33.zip)hgtfile="P33v2.zip";;
			P34.zip)hgtfile="P34v2.zip";;
			P35.zip)hgtfile="P35v2.zip";;
			P36.zip)hgtfile="P36v2.zip";;
			P37.zip)hgtfile="P37v2.zip";;
			P38.zip)hgtfile="P38v2.zip";;
			P39.zip)hgtfile="P39v2.zip";;
			P40.zip)hgtfile="P40v2.zip";;
		esac
		echo $hgtfile
		wget -N http://www.viewfinderpanoramas.org/dem3/$hgtfile --directory-prefix=$PWD/data/VFP/
		unzip -uoj $PWD/data/VFP/$hgtfile -d $PWD/data/VFP/
            done
    done

$tg/gdalchop $PWD/work/SRTM-3 $PWD/data/VFP/*.hgt
$tg/terrafit --maxnodes 1000 --maxerror 0.1 $PWD/work/SRTM-3

rm $PWD/data/VFP/*.hgt
